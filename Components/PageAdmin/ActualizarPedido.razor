@page "/admin/pedidos/editar/{id:int}"
@attribute [Authorize(Roles = "Admin,Tecnico")]
@using Microsoft.AspNetCore.Authorization
@using ProyectoMejorado.Data
@using ProyectoMejorado.Components.Models
@inject ApplicationDbContext context
@inject NavigationManager nav
@rendermode InteractiveServer

<h3 class="text-primary mb-4">📝 Actualizar Estado del Pedido</h3>

@if (pedido == null)
{
    <div class="alert alert-warning">Cargando pedido...</div>
}
else
{
    <EditForm Model="pedido" OnValidSubmit="ActualizarEstado">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label class="form-label">Cliente</label>
            <InputText class="form-control" @bind-Value="pedido.NombreCompleto" disabled />
        </div>

        <div class="mb-3">
            <label class="form-label">Productos</label>
            <InputTextArea class="form-control" @bind-Value="pedido.Productos" disabled />
        </div>

        <div class="mb-3">
            <label class="form-label">Dirección</label>
            <InputText class="form-control" @bind-Value="pedido.DireccionEnvio" disabled />
        </div>

        <div class="mb-3">
            <label class="form-label">Estado del Pedido</label>
            <InputSelect class="form-select" @bind-Value="pedido.Estado">
                <option value="Pendiente">Pendiente</option>
                <option value="Procesado">Procesado</option>
                <option value="Enviado">Enviado</option>
                <option value="Entregado">Entregado</option>
                <option value="Cancelado">Cancelado</option>
            </InputSelect>
        </div>

        <button class="btn btn-success w-100">💾 Guardar Cambios</button>
    </EditForm>
}

@code {
    [Parameter] public int id { get; set; }

    private OrdenCliente? pedido;

    protected override async Task OnInitializedAsync()
    {
        pedido = await context.OrdenesClientes.FindAsync(id);
    }

    private async Task ActualizarEstado()
    {
        context.OrdenesClientes.Update(pedido!);
        await context.SaveChangesAsync();
        nav.NavigateTo("/admin/ordenes"); // o la vista donde se listan los pedidos
    }
}
